<!DOCTYPE html>
<html lang="en">
<title>PCMS Chat App</title>
<script type="module">
    import { html, Component, render, useState, useCallback } from 'https://unpkg.com/htm/preact/standalone.module.js';

    let ws = new WebSocket("wss://"+location.host);

    function App() {

        const [messages, setMessages] = useState([]);
        const [message, setMessage] = useState("");
        const send = (e) => {
            e.preventDefault();
            ws.send(message);
        };
        const setMessageText = useCallback((e) => {
            setMessage(e.target.value);
        }, []);

        ws.onmessage = () => {
            setMessages([...messages, message]);
        };

        return html`
			<form onSubmit=${send} action="javascript:">
				<input value=${message} onInput=${setMessageText} />
				<button type="submit">Add</button>
				<ul>
					${messages.map(m => html`
						<li>${m}</li>
					`)}
				</ul>
			</form>
        `
    }
    ws.onopen = () => {
        render(html`<${App} page="All" />`, document.body);
    };
</script>
</html>